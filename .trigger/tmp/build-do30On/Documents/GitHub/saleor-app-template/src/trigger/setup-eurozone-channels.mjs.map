{
  "version": 3,
  "sources": ["../../../../../../../../src/trigger/setup-eurozone-channels.ts"],
  "sourcesContent": ["import { task } from \"@trigger.dev/sdk\";\r\n\r\n// --- CONFIGURATION ---\r\nconst EUROZONE_COUNTRIES = [\r\n    { name: \"Austria\", code: \"AT\", channel: \"austria\" },\r\n    { name: \"Belgium\", code: \"BE\", channel: \"belgium\" },\r\n    { name: \"Croatia\", code: \"HR\", channel: \"croatia\" },\r\n    { name: \"Cyprus\", code: \"CY\", channel: \"cyprus\" },\r\n    { name: \"Estonia\", code: \"EE\", channel: \"estonia\" },\r\n    { name: \"Finland\", code: \"FI\", channel: \"finland\" },\r\n    { name: \"France\", code: \"FR\", channel: \"france\" },\r\n    { name: \"Germany\", code: \"DE\", channel: \"germany\" },\r\n    { name: \"Greece\", code: \"GR\", channel: \"greece\" },\r\n    { name: \"Ireland\", code: \"IE\", channel: \"ireland\" },\r\n    { name: \"Italy\", code: \"IT\", channel: \"italy\" },\r\n    { name: \"Latvia\", code: \"LV\", channel: \"latvia\" },\r\n    { name: \"Lithuania\", code: \"LT\", channel: \"lithuania\" },\r\n    { name: \"Luxembourg\", code: \"LU\", channel: \"luxembourg\" },\r\n    { name: \"Malta\", code: \"MT\", channel: \"malta\" },\r\n    { name: \"Netherlands\", code: \"NL\", channel: \"netherlands\" },\r\n    { name: \"Portugal\", code: \"PT\", channel: \"portugal\" },\r\n    { name: \"Slovakia\", code: \"SK\", channel: \"slovakia\" },\r\n    { name: \"Slovenia\", code: \"SI\", channel: \"slovenia\" },\r\n    { name: \"Spain\", code: \"ES\", channel: \"spain\" },\r\n];\r\n\r\nexport const setupEurozoneChannels = task({\r\n    id: \"setup-eurozone-channels\",\r\n    run: async () => {\r\n        const apiUrl = process.env.SALEOR_API_URL;\r\n        let saleorToken = (process.env.SALEOR_APP_TOKEN || process.env.SALEOR_TOKEN || \"\").trim();\r\n\r\n        if (!apiUrl || !saleorToken) throw new Error(\"Missing SALEOR_API_URL or SALEOR_TOKEN\");\r\n        \r\n        saleorToken = `Bearer ${saleorToken.replace(/^bearer\\s+/i, \"\")}`;\r\n\r\n        const saleorHeaders = {\r\n            'Authorization': saleorToken,\r\n            'Content-Type': 'application/json'\r\n        };\r\n\r\n        const saleorFetch = async (query: string, variables: any = {}) => {\r\n            const res = await fetch(apiUrl, {\r\n                method: 'POST',\r\n                headers: saleorHeaders,\r\n                body: JSON.stringify({ query, variables })\r\n            });\r\n            const json: any = await res.json();\r\n            if (json.errors) {\r\n                console.error(\"‚ùå Saleor Error:\", JSON.stringify(json.errors));\r\n            }\r\n            return json;\r\n        };\r\n\r\n        console.log(\"üöÄ Starting Eurozone Channel Setup...\");\r\n\r\n        // 1. Get existing channels\r\n        const existingChannelsRes = await saleorFetch(`query { channels { id slug } }`);\r\n        const existingChannels = existingChannelsRes.data?.channels || [];\r\n        const existingSlugs = new Set(existingChannels.map((c: any) => c.slug));\r\n\r\n        // 2. Process each country\r\n        for (const country of EUROZONE_COUNTRIES) {\r\n            console.log(`--- Processing ${country.name} (${country.code}) ---`);\r\n\r\n            let channelId: string;\r\n\r\n            // 2.1 Get or Create Channel\r\n            if (existingSlugs.has(country.channel)) {\r\n                console.log(`‚úÖ Channel '${country.channel}' already exists.`);\r\n                channelId = existingChannels.find((c: any) => c.slug === country.channel).id;\r\n            } else {\r\n                console.log(`‚ú® Creating Channel: ${country.channel}`);\r\n                const createRes = await saleorFetch(`\r\n                    mutation CreateChannel($input: ChannelCreateInput!) {\r\n                        channelCreate(input: $input) {\r\n                            channel { id }\r\n                            errors { field message }\r\n                        }\r\n                    }\r\n                `, {\r\n                    input: {\r\n                        name: country.name,\r\n                        slug: country.channel,\r\n                        currencyCode: \"EUR\",\r\n                        isActive: true,\r\n                        defaultCountry: country.code\r\n                    }\r\n                });\r\n                channelId = createRes.data?.channelCreate?.channel?.id;\r\n                if (!channelId) {\r\n                    console.error(`‚ùå Failed to create channel ${country.channel}`);\r\n                    continue;\r\n                }\r\n            }\r\n\r\n            // 2.2 Get or Create Shipping Zone\r\n            const zoneName = `Shipping ${country.name}`;\r\n            const existingZoneRes = await saleorFetch(`query FindZone($n: String!) { shippingZones(filter: { search: $n }, first: 5) { edges { node { id name } } } }`, { n: zoneName });\r\n            let zoneId = existingZoneRes.data?.shippingZones?.edges?.find((e: any) => e.node.name === zoneName)?.node?.id;\r\n\r\n            if (zoneId) {\r\n                console.log(`‚úÖ Shipping Zone '${zoneName}' already exists.`);\r\n            } else {\r\n                console.log(`üöö Creating Shipping Zone: ${zoneName}`);\r\n                const createZoneRes = await saleorFetch(`\r\n                    mutation CreateZone($input: ShippingZoneCreateInput!) {\r\n                        shippingZoneCreate(input: $input) {\r\n                            shippingZone { id }\r\n                            errors { field message }\r\n                        }\r\n                    }\r\n                `, {\r\n                    input: {\r\n                        name: zoneName,\r\n                        countries: [country.code],\r\n                        addChannels: [channelId]\r\n                    }\r\n                });\r\n                zoneId = createZoneRes.data?.shippingZoneCreate?.shippingZone?.id;\r\n            }\r\n\r\n            if (!zoneId) {\r\n                console.error(`‚ùå Failed to create shipping zone for ${country.name}`);\r\n                continue;\r\n            }\r\n\r\n            // 2.3 Ensure Channel is in Shipping Zone\r\n            await saleorFetch(`\r\n                mutation UpdateZone($id: ID!, $input: ShippingZoneUpdateInput!) {\r\n                    shippingZoneUpdate(id: $id, input: $input) {\r\n                        errors { field message }\r\n                    }\r\n                }\r\n            `, {\r\n                id: zoneId,\r\n                input: { addChannels: [channelId] }\r\n            });\r\n\r\n            // 2.4 Add Standard Shipping Method (if none exists)\r\n            const zoneDetailsRes = await saleorFetch(`query GetZone($id: ID!) { shippingZone(id: $id) { shippingMethods { id name } } }`, { id: zoneId });\r\n            const existingMethods = zoneDetailsRes.data?.shippingZone?.shippingMethods || [];\r\n\r\n            if (existingMethods.length === 0) {\r\n                console.log(`üì¶ Adding Standard Shipping Method to ${zoneName}`);\r\n                const methodRes = await saleorFetch(`\r\n                    mutation CreateMethod($input: ShippingPriceInput!) {\r\n                        shippingPriceCreate(input: $input) {\r\n                            shippingMethod { id }\r\n                            errors { field message }\r\n                        }\r\n                    }\r\n                `, {\r\n                    input: {\r\n                        name: \"Standard Shipping\",\r\n                        type: \"PRICE\",\r\n                        shippingZone: zoneId\r\n                    }\r\n                });\r\n\r\n                const methodId = methodRes.data?.shippingPriceCreate?.shippingMethod?.id;\r\n                \r\n                if (methodId) {\r\n                    console.log(`üîó Linking Shipping Method to Channel: ${country.channel}`);\r\n                    await saleorFetch(`\r\n                        mutation UpdateListing($id: ID!, $input: ShippingMethodChannelListingInput!) {\r\n                            shippingMethodChannelListingUpdate(id: $id, input: $input) {\r\n                                errors { field message }\r\n                            }\r\n                        }\r\n                    `, {\r\n                        id: methodId,\r\n                        input: {\r\n                            addChannels: [{\r\n                                channelId: channelId,\r\n                                price: 0\r\n                            }]\r\n                        }\r\n                    });\r\n                } else {\r\n                    console.error(`‚ùå Failed to create shipping method for ${zoneName}`);\r\n                }\r\n            } else {\r\n                console.log(`‚úÖ Shipping methods already exist for ${zoneName}.`);\r\n            }\r\n        }\r\n\r\n        console.log(\"‚úÖ Eurozone Channel Setup Complete!\");\r\n    }\r\n});\r\n"],
  "mappings": "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",
  "names": []
}
