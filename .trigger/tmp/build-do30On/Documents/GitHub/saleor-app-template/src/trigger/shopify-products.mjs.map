{
  "version": 3,
  "sources": ["../../../../../../../../src/trigger/shopify-products.ts"],
  "sourcesContent": ["import { task } from \"@trigger.dev/sdk\";\r\nimport { bulkTranslateProducts } from \"./bulk-translate-products\";\r\nimport { db } from \"../db\";\r\nimport { integrations, users } from \"../db/schema\";\r\nimport { eq } from \"drizzle-orm\";\r\n\r\n// --- VERSIONING FOR VERIFICATION ---\r\nconst SYNC_VERSION = \"LITERAL-CLONE-V12-BRANDFIX\";\r\n\r\n// --- CONFIGURATION FROM ENV ---\r\nconst BRAND_MODEL_TYPE_ID = process.env.SALEOR_BRAND_MODEL_TYPE_ID;\r\nconst BRAND_ATTRIBUTE_ID = process.env.SALEOR_BRAND_ATTRIBUTE_ID;\r\nconst PRODUCT_TYPE_ID = process.env.SALEOR_PRODUCT_TYPE_ID;\r\nconst CATEGORY_ID = process.env.SALEOR_CATEGORY_ID;\r\nconst DEFAULT_WAREHOUSE_ID = process.env.SALEOR_WAREHOUSE_ID;\r\nconst PHOTOROOM_API_KEY = process.env.PHOTOROOM_API_KEY;\r\nconst COUNTRY_TO_CHANNEL: Record<string, string> = {\r\n    \"AT\": \"austria\", \"BE\": \"belgium\", \"HR\": \"croatia\", \"CY\": \"cyprus\",\r\n    \"EE\": \"estonia\", \"FI\": \"finland\", \"FR\": \"france\", \"DE\": \"germany\",\r\n    \"GR\": \"greece\", \"IE\": \"ireland\", \"IT\": \"italy\", \"LV\": \"latvia\",\r\n    \"LT\": \"lithuania\", \"LU\": \"luxembourg\", \"MT\": \"malta\", \"NL\": \"netherlands\",\r\n    \"PT\": \"portugal\", \"SK\": \"slovakia\", \"SI\": \"slovenia\", \"ES\": \"spain\"\r\n};\r\n\r\n// --- HELPERS ---\r\n\r\nfunction textToEditorJs(text: string) {\r\n    const cleanText = text ? text.replace(/\\n/g, \"<br>\") : \"\";\r\n    return JSON.stringify({\r\n        time: Date.now(),\r\n        blocks: [{ type: \"paragraph\", data: { text: cleanText } }],\r\n        version: \"2.25.0\"\r\n    });\r\n}\r\n\r\nconst DEFAULT_VENDOR_ADDRESS = {\r\n    firstName: \"Logistics\",\r\n    lastName: \"Manager\",\r\n    companyName: \"Vendor Warehouse\",\r\n    streetAddress1: \"123 Market St\",\r\n    city: \"San Francisco\",\r\n    postalCode: \"94105\",\r\n    country: \"US\",\r\n    countryArea: \"CA\"\r\n};\r\n\r\n// --- TASK DEFINITION ---\r\n\r\nexport const shopifyProductSync = task({\r\n    id: \"shopify-product-sync\",\r\n    run: async (payload: { integrationId: number }) => {\r\n        console.log(`üöÄ [${SYNC_VERSION}] Execution Start. Integration: ${payload.integrationId}`);\r\n\r\n        // --- 1. SETUP & AUTH ---\r\n        const integrationData = await db.select({\r\n            id: integrations.id,\r\n            accessToken: integrations.accessToken,\r\n            storeUrl: integrations.storeUrl,\r\n            provider: integrations.provider,\r\n            brandName: users.brand,\r\n            shippingCountries: users.shippingCountries,\r\n            settings: integrations.settings\r\n        })\r\n            .from(integrations)\r\n            .innerJoin(users, eq(integrations.userId, users.id))\r\n            .where(eq(integrations.id, payload.integrationId))\r\n            .limit(1);\r\n\r\n        const integration = integrationData[0];\r\n        if (!integration) throw new Error(\"Integration not found\");\r\n\r\n        const officialBrandName = integration.brandName;\r\n        console.log(`üè∑Ô∏è  Using Official Brand Name from DB: \"${officialBrandName}\"`);\r\n        if (integration.provider !== \"shopify\") {\r\n            console.warn(`‚ö†Ô∏è skipping: Not Shopify`);\r\n            return;\r\n        }\r\n\r\n        const apiUrl = process.env.SALEOR_API_URL;\r\n        let saleorToken = (process.env.SALEOR_APP_TOKEN || process.env.SALEOR_TOKEN || \"\").trim();\r\n\r\n        // --- ü©∫ TOKEN VERIFICATION (MASKED) ---\r\n        if (saleorToken) {\r\n            const start = saleorToken.substring(0, 5);\r\n            const end = saleorToken.substring(saleorToken.length - 5);\r\n            console.log(`üîë [SECURITY] Using Saleor Token: ${start}...${end} (Length: ${saleorToken.length})`);\r\n            saleorToken = `Bearer ${saleorToken.replace(/^bearer\\s+/i, \"\")}`;\r\n        }\r\n\r\n        if (!apiUrl || !saleorToken) throw new Error(\"Missing SALEOR_API_URL or SALEOR_TOKEN\");\r\n        console.log(`üåê [ENV] SALEOR_API_URL: ${apiUrl}`);\r\n\r\n        const saleorHeaders = {\r\n            'Authorization': saleorToken,\r\n            'Content-Type': 'application/json'\r\n        };\r\n\r\n        // Helper: Centralized Fetch (RESILIENT TO 400 ERRORS)\r\n        const saleorFetch = async (query: string, variables: any = {}) => {\r\n            try {\r\n                const res = await fetch(apiUrl, {\r\n                    method: 'POST',\r\n                    headers: saleorHeaders,\r\n                    body: JSON.stringify({ query, variables })\r\n                });\r\n\r\n                // Saleor returns 400 for structural errors. We MUST parse to handle fallout.\r\n                const json: any = await res.json();\r\n\r\n                if (json.errors) {\r\n                    const isSchemaError = json.errors[0]?.message?.includes(\"Cannot query field\");\r\n                    if (isSchemaError) {\r\n                        console.error(\"   ‚ùå Saleor Schema Error:\", json.errors[0].message);\r\n                    } else {\r\n                        console.error(\"   ‚ùå Saleor Error:\", JSON.stringify(json.errors[0]?.message || json.errors));\r\n                    }\r\n                }\r\n                return json;\r\n            } catch (e) {\r\n                console.error(\"   ‚ùå Network Error during Saleor Request:\", e);\r\n                return {};\r\n            }\r\n        };\r\n\r\n        // --- 2. FETCH SHOPIFY DATA ---\r\n        console.log(\"   üì° Connecting to Shopify...\");\r\n        const fetchShopify = async (q: string) => {\r\n            const query = `{ products(first:20${q ? `, query: \"${q}\"` : \"\"}) { edges { node { id title vendor descriptionHtml images(first:1){edges{node{url}}} variants(first:10){edges{node{id title sku price inventoryQuantity}}} } } } }`;\r\n            return await fetch(`https://${integration.storeUrl}/admin/api/2024-04/graphql.json`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'X-Shopify-Access-Token': integration.accessToken || \"\"\r\n                },\r\n                body: JSON.stringify({ query })\r\n            });\r\n        };\r\n\r\n        // Attempt strict fetch first\r\n        let shopifyRes = await fetchShopify(\"status:active AND inventory_total:>0\");\r\n        if (shopifyRes.status === 401 || shopifyRes.status === 403) throw new Error(\"Shopify API Access Denied.\");\r\n        let shopifyJson = await shopifyRes.json();\r\n        let products = shopifyJson.data?.products?.edges || [];\r\n        console.log(`   üì¶ Fetched ${products.length} products (Strict mode).`);\r\n\r\n        if (products.length === 0) {\r\n            console.warn(\"   ‚ö†Ô∏è  Strict mode returned 0. Retrying loose mode...\");\r\n            shopifyRes = await fetchShopify(\"\");\r\n            shopifyJson = await shopifyRes.json();\r\n            products = shopifyJson.data?.products?.edges || [];\r\n            console.log(`   ‚ÑπÔ∏è  Loose mode found ${products.length} products.`);\r\n        }\r\n\r\n        // --- 3. CORE SYNC FUNCTIONS ---\r\n\r\n        const getSaleorChannels = async () => {\r\n            const query = `{ channels { id slug currencyCode isActive } }`;\r\n            const json = await saleorFetch(query);\r\n            return (json.data?.channels || []).filter((c: any) => c.isActive);\r\n        };\r\n\r\n        const getOrCreateBrandPage = async (name: string) => {\r\n            if (!name) return null;\r\n            // Use exact title matching to avoid fuzzy search duplicates\r\n            const find = await saleorFetch(`query Find($n:String!){pages(filter:{search:$n},first:5){edges{node{id title isPublished}}}}`, { n: name });\r\n            const existing = find.data?.pages?.edges?.find((e: any) => e.node.title === name)?.node;\r\n\r\n            if (existing) {\r\n                if (!existing.isPublished) {\r\n                    await saleorFetch(`mutation Pub($id:ID!){pageUpdate(id:$id,input:{isPublished:true}){errors{field}}}`, { id: existing.id });\r\n                }\r\n                return existing.id;\r\n            }\r\n            console.log(`   ‚ú® Creating Brand Page: \"${name}\"`);\r\n            const create = await saleorFetch(`mutation Create($n:String!,$t:ID!){pageCreate(input:{title:$n,pageType:$t,isPublished:true,content:\"{}\"}){page{id} errors{field message}}}`, { n: name, t: BRAND_MODEL_TYPE_ID });\r\n            return create.data?.pageCreate?.page?.id;\r\n        };\r\n\r\n        const getOrCreateShippingZones = async () => {\r\n            const find = await saleorFetch(`query { shippingZones(first:100) { edges { node { id name } } } }`);\r\n            return find.data?.shippingZones?.edges?.map((e: any) => e.node) || [];\r\n        };\r\n\r\n        const getOrCreateWarehouse = async (vendorName: string, channels: any[]) => {\r\n            const slug = `vendor-${vendorName.toLowerCase().replace(/[^a-z0-9]/g, '-')}`;\r\n            // Use Exact Slug Matching if possible, or filter results\r\n            const find = await saleorFetch(`query Find($s:String!){warehouses(filter:{search:$s},first:5){edges{node{id name slug}}}}`, { s: vendorName });\r\n\r\n            const existing = find.data?.warehouses?.edges?.find((e: any) => e.node.slug === slug || e.node.name === `${vendorName} Warehouse`)?.node;\r\n            if (existing) return existing.id;\r\n\r\n            console.log(`   üè≠ Creating Warehouse: \"${vendorName}\"`);\r\n            const inputs = {\r\n                name: `${vendorName} Warehouse`,\r\n                slug: slug,\r\n                address: DEFAULT_VENDOR_ADDRESS,\r\n                email: \"vendor@example.com\"\r\n            };\r\n\r\n            const createRes = await saleorFetch(`mutation CreateWarehouse($input:WarehouseCreateInput!){createWarehouse(input:$input){warehouse{id} errors{field message}}}`, {\r\n                input: inputs\r\n            });\r\n\r\n            const result = createRes.data?.createWarehouse;\r\n\r\n            if (result?.errors?.length > 0) {\r\n                if (result.errors.some((e: any) => e.field === 'slug')) {\r\n                    const slugSearch = await saleorFetch(`query FindS($s:String!){warehouses(filter:{search:$s},first:10){edges{node{id slug}}}}`, { s: slug });\r\n                    const found = slugSearch.data?.warehouses?.edges?.find((e: any) => e.node.slug === slug)?.node;\r\n                    if (found) return found.id;\r\n                }\r\n                console.error(\"   ‚ö†Ô∏è Warehouse Creation Failed:\", JSON.stringify(result.errors));\r\n                return null;\r\n            }\r\n\r\n            const newId = result?.warehouse?.id;\r\n            if (newId) {\r\n                console.log(`   ‚úÖ Warehouse Created: ${newId}`);\r\n                // Link to Channels\r\n                for (const ch of channels) {\r\n                    await saleorFetch(`mutation UpdCh($id:ID!,$input:ChannelUpdateInput!){channelUpdate(id:$id,input:$input){errors{field}}}`, { id: ch.id, input: { addWarehouses: [newId] } });\r\n                }\r\n                // Link to EVERY Shipping Zone (ensure global fulfillability for vendor)\r\n                const zones = await getOrCreateShippingZones();\r\n                for (const zone of zones) {\r\n                    await saleorFetch(`mutation UpdZone($id:ID!,$input:ShippingZoneUpdateInput!){shippingZoneUpdate(id:$id,input:$input){errors{field}}}`, { id: zone.id, input: { addWarehouses: [newId] } });\r\n                }\r\n            }\r\n            return newId;\r\n        };\r\n\r\n        async function processImage(productId: string, imageUrl: string, title: string) {\r\n            console.log(\"      üé® Managing Product Media...\");\r\n\r\n            // 1. Fetch Existing Media\r\n            const mediaRes = await saleorFetch(`query GetMedia($id:ID!){product(id:$id){media{id}}}`, { id: productId });\r\n            const existingMedia = mediaRes.data?.product?.media || [];\r\n\r\n            // 2. Delete Existing Media\r\n            if (existingMedia.length > 0) {\r\n                console.log(`      üßπ Deleting ${existingMedia.length} existing images...`);\r\n                for (const media of existingMedia) {\r\n                    await saleorFetch(`mutation DelMedia($id:ID!){productMediaDelete(id:$id){errors{field message}}}`, { id: media.id });\r\n                }\r\n            }\r\n\r\n            const photoroomKey = PHOTOROOM_API_KEY;\r\n            let imageBlob: Blob | null = null;\r\n            if (photoroomKey) {\r\n                try {\r\n                    const shopifyImgRes = await fetch(imageUrl);\r\n                    if (shopifyImgRes.ok) {\r\n                        const originalBlob = await shopifyImgRes.blob();\r\n                        const formData = new FormData();\r\n                        formData.append(\"image_file\", originalBlob, \"original.jpg\");\r\n                        formData.append(\"background.color\", \"FFFFFF\");\r\n                        formData.append(\"format\", \"webp\");\r\n                        const prRes = await fetch(\"https://sdk.photoroom.com/v1/segment\", {\r\n                            method: \"POST\",\r\n                            headers: { \"x-api-key\": photoroomKey },\r\n                            body: formData\r\n                        });\r\n                        if (prRes.ok) imageBlob = await prRes.blob();\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"      ‚ùå Photoroom error:\", e);\r\n                }\r\n            }\r\n\r\n            if (imageBlob) {\r\n                const fd = new FormData();\r\n                const ops = {\r\n                    query: `mutation CreateMedia($p: ID!, $i: Upload!, $a: String) { productMediaCreate(input: { product: $p, image: $i, alt: $a }) { media { id } errors { field message } } }`,\r\n                    variables: { p: productId, i: null, a: title }\r\n                };\r\n                fd.append(\"operations\", JSON.stringify(ops));\r\n                fd.append(\"map\", JSON.stringify({ \"0\": [\"variables.i\"] }));\r\n                fd.append(\"0\", imageBlob, \"image.webp\");\r\n                await fetch(apiUrl!, { method: 'POST', headers: { 'Authorization': saleorToken }, body: fd });\r\n            } else {\r\n                await saleorFetch(`mutation AddMedia($id: ID!, $url: String!, $alt: String) { productMediaCreate(input: { product: $id, mediaUrl: $url, alt: $alt }) { media { id } errors { field message } } }`, {\r\n                    id: productId, url: imageUrl, alt: title\r\n                });\r\n            }\r\n        }\r\n\r\n        const channels = await getSaleorChannels();\r\n        const globalCountries = (integrationData[0]?.shippingCountries as string[]) || [];\r\n        const isOptOut = !globalCountries || globalCountries.length === 0;\r\n        const targetCountryCodes = isOptOut ? Object.keys(COUNTRY_TO_CHANNEL) : globalCountries;\r\n        const activeChannels = channels.filter((ch: any) => \r\n            targetCountryCodes.some((c: string) => COUNTRY_TO_CHANNEL[c] === ch.slug)\r\n        );\r\n\r\n        if (channels.length === 0) { console.error(\"‚ùå No Active Channels found.\"); return; }\r\n\r\n        // --- 4. SETUP CONTEXT (DEDUPLICATION) ---\r\n        // --- 4. SETUP CONTEXT (DEDUPLICATION) ---\r\n        const uniqueVendors: string[] = [officialBrandName];\r\n        const vendorContext = new Map<string, { brandPageId: string | null, warehouseId: string | null }>();\r\n\r\n        console.log(`   üèóÔ∏è  Setting up context for ${uniqueVendors.length} unique vendors...`);\r\n        for (const vendor of uniqueVendors) {\r\n            const brandPageId = await getOrCreateBrandPage(vendor);\r\n            let warehouseId = await getOrCreateWarehouse(vendor, channels);\r\n            if (!warehouseId) warehouseId = DEFAULT_WAREHOUSE_ID;\r\n            vendorContext.set(vendor, { brandPageId, warehouseId });\r\n        }\r\n\r\n        // --- 5. PARALLEL PROCESSING ---\r\n        console.log(`üì¶ Parallel Sync for ${products.length} products...`);\r\n\r\n        const processedProductIds: string[] = [];\r\n\r\n        await Promise.all(products.map(async (pEdge: any) => {\r\n            const p = pEdge.node;\r\n            const vendorName = officialBrandName;\r\n            const context = vendorContext.get(vendorName);\r\n            const brandPageId = context?.brandPageId;\r\n            const targetWarehouseId = context?.warehouseId;\r\n\r\n            let finalProductId: string | null = null;\r\n            const cleanTitle = p.title.trim();\r\n            const predictableSlug = cleanTitle.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');\r\n\r\n            const slugCheck = await saleorFetch(`query FindSlug($s:String!){product(slug:$s){id}}`, { s: predictableSlug });\r\n            finalProductId = slugCheck.data?.product?.id;\r\n\r\n            if (!finalProductId) {\r\n                const createProdRes = await saleorFetch(`mutation Create($input:ProductCreateInput!){productCreate(input:$input){product{id} errors{field message}}}`, {\r\n                    input: {\r\n                        name: p.title,\r\n                        slug: predictableSlug,\r\n                        externalReference: p.id.split('/').pop(),\r\n                        productType: PRODUCT_TYPE_ID,\r\n                        category: CATEGORY_ID,\r\n                        description: textToEditorJs(p.descriptionHtml || p.title),\r\n                        metadata: [{ key: \"brand\", value: vendorName }]\r\n                    }\r\n                });\r\n                finalProductId = createProdRes.data?.productCreate?.product?.id;\r\n            } else {\r\n                await saleorFetch(`mutation Update($id:ID!,$input:ProductInput!){productUpdate(id:$id,input:$input){errors{field message}}}`, {\r\n                    id: finalProductId,\r\n                    input: {\r\n                        description: textToEditorJs(p.descriptionHtml || p.title),\r\n                        externalReference: p.id.split('/').pop(),\r\n                        metadata: [{ key: \"brand\", value: vendorName }]\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (!finalProductId) return;\r\n\r\n            if (brandPageId && BRAND_ATTRIBUTE_ID) {\r\n                await saleorFetch(`mutation UpdateProd($id:ID!,$input:ProductInput!){productUpdate(id:$id,input:$input){errors{field message}}}`, {\r\n                    id: finalProductId,\r\n                    input: { attributes: [{ id: BRAND_ATTRIBUTE_ID, reference: brandPageId }] }\r\n                });\r\n            }\r\n\r\n\r\n\r\n            if (p.images?.edges?.[0]?.node?.url) {\r\n                await processImage(finalProductId, p.images.edges[0].node.url, p.title);\r\n            }\r\n\r\n            const variants = p.variants?.edges || [];\r\n            const existingVarData = await saleorFetch(`query GetVars($id:ID!){product(id:$id){variants{id sku}}}`, { id: finalProductId });\r\n            const existingVariants = existingVarData.data?.product?.variants || [];\r\n            if (existingVariants.length > 0) {\r\n                await saleorFetch(`mutation BulkDelete($ids:[ID!]!){productVariantBulkDelete(ids:$ids){errors{field message}}}`, { ids: existingVariants.map((v: any) => v.id) });\r\n            }\r\n\r\n            // --- üì¢ Step 1: Create all variants first (without prices) ---\r\n            for (const vEdge of variants) {\r\n                const v = vEdge.node;\r\n                const variantExternalRef = `${p.id.split('/').pop()}-${v.id.split('/').pop()}`; // Unique external reference for variant\r\n                await saleorFetch(`mutation CreateVar($input:ProductVariantCreateInput!){productVariantCreate(input:$input){productVariant{id} errors{field message}}}`, {\r\n                    input: {\r\n                        product: finalProductId,\r\n                        sku: v.sku || variantExternalRef, // Use SKU if available, otherwise externalRef\r\n                        name: v.title || \"Default\",\r\n                        externalReference: variantExternalRef,\r\n                        attributes: [],\r\n                        trackInventory: true,\r\n                        stocks: targetWarehouseId ? [{ warehouse: targetWarehouseId, quantity: v.inventoryQuantity || 0 }] : []\r\n                    }\r\n                });\r\n            }\r\n\r\n            // --- üì¢ Step 2: Ensure Product is in Channels (Saleor requirement for Variant Prices) ---\r\n            const dateStr = new Date().toISOString().split('T')[0];\r\n            const channelListings = activeChannels.map((ch: any) => ({\r\n                channelId: ch.id,\r\n                isPublished: true,\r\n                publicationDate: dateStr,\r\n                isAvailableForPurchase: true,\r\n                visibleInListings: true,\r\n                availableForPurchaseAt: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()\r\n            }));\r\n            await saleorFetch(`mutation UpdChannel($id:ID!,$input:ProductChannelListingUpdateInput!){productChannelListingUpdate(id:$id,input:$input){errors{field}}}`, {\r\n                id: finalProductId,\r\n                input: { updateChannels: channelListings }\r\n            });\r\n\r\n            // --- üí∞ Step 3: Assign Prices to Variants (Now that product is in channels) ---\r\n            for (const vEdge of p.variants.edges) {\r\n                const v = vEdge.node;\r\n                const predictableSlug = `${p.id.split('/').pop()}-${v.id.split('/').pop()}`;\r\n\r\n                // Lookup created variant\r\n                const findVar = await saleorFetch(`query FindVar($s:String!){productVariant(externalReference:$s){id}}`, { s: predictableSlug });\r\n                const variantId = findVar.data?.productVariant?.id;\r\n\r\n                if (variantId) {\r\n                    const price = parseFloat(v.price || \"0\");\r\n                    if (price > 0) {\r\n                        const priceListings = activeChannels.map((ch: any) => ({\r\n                            channelId: ch.id,\r\n                            price: price,\r\n                            costPrice: parseFloat(v.compare_at_price || price.toString())\r\n                        }));\r\n                        await saleorFetch(`mutation UpdVarChan($id:ID!,$input:[ProductVariantChannelListingAddInput!]!){productVariantChannelListingUpdate(id:$id,input:$input){errors{field message}}}`, {\r\n                            id: variantId,\r\n                            input: priceListings\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n\r\n            // üì¢ Trigger Translation\r\n            if (finalProductId) {\r\n                processedProductIds.push(finalProductId);\r\n            }\r\n        }));\r\n        \r\n        // üì¢ Trigger Bulk Translation Task\r\n        if (processedProductIds.length > 0) {\r\n            await bulkTranslateProducts.trigger({ productIds: processedProductIds });\r\n        }\r\n\r\n        console.log(`‚úÖ [${SYNC_VERSION}] Sync Complete for ${officialBrandName}`);\r\n    }\r\n});\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAOA,IAAM,eAAe;AAGrB,IAAM,sBAAsB,QAAQ,IAAI;AACxC,IAAM,qBAAqB,QAAQ,IAAI;AACvC,IAAM,kBAAkB,QAAQ,IAAI;AACpC,IAAM,cAAc,QAAQ,IAAI;AAChC,IAAM,uBAAuB,QAAQ,IAAI;AACzC,IAAM,oBAAoB,QAAQ,IAAI;AACtC,IAAM,qBAA6C;AAAA,EAC/C,MAAM;AAAA,EAAW,MAAM;AAAA,EAAW,MAAM;AAAA,EAAW,MAAM;AAAA,EACzD,MAAM;AAAA,EAAW,MAAM;AAAA,EAAW,MAAM;AAAA,EAAU,MAAM;AAAA,EACxD,MAAM;AAAA,EAAU,MAAM;AAAA,EAAW,MAAM;AAAA,EAAS,MAAM;AAAA,EACtD,MAAM;AAAA,EAAa,MAAM;AAAA,EAAc,MAAM;AAAA,EAAS,MAAM;AAAA,EAC5D,MAAM;AAAA,EAAY,MAAM;AAAA,EAAY,MAAM;AAAA,EAAY,MAAM;AAChE;AAIA,SAAS,eAAe,MAAc;AAClC,QAAM,YAAY,OAAO,KAAK,QAAQ,OAAO,MAAM,IAAI;AACvD,SAAO,KAAK,UAAU;AAAA,IAClB,MAAM,KAAK,IAAI;AAAA,IACf,QAAQ,CAAC,EAAE,MAAM,aAAa,MAAM,EAAE,MAAM,UAAU,EAAE,CAAC;AAAA,IACzD,SAAS;AAAA,EACb,CAAC;AACL;AAPS;AAST,IAAM,yBAAyB;AAAA,EAC3B,WAAW;AAAA,EACX,UAAU;AAAA,EACV,aAAa;AAAA,EACb,gBAAgB;AAAA,EAChB,MAAM;AAAA,EACN,YAAY;AAAA,EACZ,SAAS;AAAA,EACT,aAAa;AACjB;AAIO,IAAM,qBAAqB,KAAK;AAAA,EACnC,IAAI;AAAA,EACJ,KAAK,8BAAO,YAAuC;AAC/C,YAAQ,IAAI,OAAO,YAAY,mCAAmC,QAAQ,aAAa,EAAE;AAGzF,UAAM,kBAAkB,MAAM,GAAG,OAAO;AAAA,MACpC,IAAI,aAAa;AAAA,MACjB,aAAa,aAAa;AAAA,MAC1B,UAAU,aAAa;AAAA,MACvB,UAAU,aAAa;AAAA,MACvB,WAAW,MAAM;AAAA,MACjB,mBAAmB,MAAM;AAAA,MACzB,UAAU,aAAa;AAAA,IAC3B,CAAC,EACI,KAAK,YAAY,EACjB,UAAU,OAAO,GAAG,aAAa,QAAQ,MAAM,EAAE,CAAC,EAClD,MAAM,GAAG,aAAa,IAAI,QAAQ,aAAa,CAAC,EAChD,MAAM,CAAC;AAEZ,UAAM,cAAc,gBAAgB,CAAC;AACrC,QAAI,CAAC,YAAa,OAAM,IAAI,MAAM,uBAAuB;AAEzD,UAAM,oBAAoB,YAAY;AACtC,YAAQ,IAAI,4CAA4C,iBAAiB,GAAG;AAC5E,QAAI,YAAY,aAAa,WAAW;AACpC,cAAQ,KAAK,0BAA0B;AACvC;AAAA,IACJ;AAEA,UAAM,SAAS,QAAQ,IAAI;AAC3B,QAAI,eAAe,QAAQ,IAAI,oBAAoB,QAAQ,IAAI,gBAAgB,IAAI,KAAK;AAGxF,QAAI,aAAa;AACb,YAAM,QAAQ,YAAY,UAAU,GAAG,CAAC;AACxC,YAAM,MAAM,YAAY,UAAU,YAAY,SAAS,CAAC;AACxD,cAAQ,IAAI,qCAAqC,KAAK,MAAM,GAAG,aAAa,YAAY,MAAM,GAAG;AACjG,oBAAc,UAAU,YAAY,QAAQ,eAAe,EAAE,CAAC;AAAA,IAClE;AAEA,QAAI,CAAC,UAAU,CAAC,YAAa,OAAM,IAAI,MAAM,wCAAwC;AACrF,YAAQ,IAAI,4BAA4B,MAAM,EAAE;AAEhD,UAAM,gBAAgB;AAAA,MAClB,iBAAiB;AAAA,MACjB,gBAAgB;AAAA,IACpB;AAGA,UAAM,cAAc,8BAAO,OAAe,YAAiB,CAAC,MAAM;AAC9D,UAAI;AACA,cAAM,MAAM,MAAM,MAAM,QAAQ;AAAA,UAC5B,QAAQ;AAAA,UACR,SAAS;AAAA,UACT,MAAM,KAAK,UAAU,EAAE,OAAO,UAAU,CAAC;AAAA,QAC7C,CAAC;AAGD,cAAM,OAAY,MAAM,IAAI,KAAK;AAEjC,YAAI,KAAK,QAAQ;AACb,gBAAM,gBAAgB,KAAK,OAAO,CAAC,GAAG,SAAS,SAAS,oBAAoB;AAC5E,cAAI,eAAe;AACf,oBAAQ,MAAM,6BAA6B,KAAK,OAAO,CAAC,EAAE,OAAO;AAAA,UACrE,OAAO;AACH,oBAAQ,MAAM,sBAAsB,KAAK,UAAU,KAAK,OAAO,CAAC,GAAG,WAAW,KAAK,MAAM,CAAC;AAAA,UAC9F;AAAA,QACJ;AACA,eAAO;AAAA,MACX,SAAS,GAAG;AACR,gBAAQ,MAAM,6CAA6C,CAAC;AAC5D,eAAO,CAAC;AAAA,MACZ;AAAA,IACJ,GAxBoB;AA2BpB,YAAQ,IAAI,gCAAgC;AAC5C,UAAM,eAAe,8BAAO,MAAc;AACtC,YAAM,QAAQ,sBAAsB,IAAI,aAAa,CAAC,MAAM,EAAE;AAC9D,aAAO,MAAM,MAAM,WAAW,YAAY,QAAQ,mCAAmC;AAAA,QACjF,QAAQ;AAAA,QACR,SAAS;AAAA,UACL,gBAAgB;AAAA,UAChB,0BAA0B,YAAY,eAAe;AAAA,QACzD;AAAA,QACA,MAAM,KAAK,UAAU,EAAE,MAAM,CAAC;AAAA,MAClC,CAAC;AAAA,IACL,GAVqB;AAarB,QAAI,aAAa,MAAM,aAAa,sCAAsC;AAC1E,QAAI,WAAW,WAAW,OAAO,WAAW,WAAW,IAAK,OAAM,IAAI,MAAM,4BAA4B;AACxG,QAAI,cAAc,MAAM,WAAW,KAAK;AACxC,QAAI,WAAW,YAAY,MAAM,UAAU,SAAS,CAAC;AACrD,YAAQ,IAAI,iBAAiB,SAAS,MAAM,0BAA0B;AAEtE,QAAI,SAAS,WAAW,GAAG;AACvB,cAAQ,KAAK,uDAAuD;AACpE,mBAAa,MAAM,aAAa,EAAE;AAClC,oBAAc,MAAM,WAAW,KAAK;AACpC,iBAAW,YAAY,MAAM,UAAU,SAAS,CAAC;AACjD,cAAQ,IAAI,2BAA2B,SAAS,MAAM,YAAY;AAAA,IACtE;AAIA,UAAM,oBAAoB,mCAAY;AAClC,YAAM,QAAQ;AACd,YAAM,OAAO,MAAM,YAAY,KAAK;AACpC,cAAQ,KAAK,MAAM,YAAY,CAAC,GAAG,OAAO,CAAC,MAAW,EAAE,QAAQ;AAAA,IACpE,GAJ0B;AAM1B,UAAM,uBAAuB,8BAAO,SAAiB;AACjD,UAAI,CAAC,KAAM,QAAO;AAElB,YAAM,OAAO,MAAM,YAAY,gGAAgG,EAAE,GAAG,KAAK,CAAC;AAC1I,YAAM,WAAW,KAAK,MAAM,OAAO,OAAO,KAAK,CAAC,MAAW,EAAE,KAAK,UAAU,IAAI,GAAG;AAEnF,UAAI,UAAU;AACV,YAAI,CAAC,SAAS,aAAa;AACvB,gBAAM,YAAY,qFAAqF,EAAE,IAAI,SAAS,GAAG,CAAC;AAAA,QAC9H;AACA,eAAO,SAAS;AAAA,MACpB;AACA,cAAQ,IAAI,8BAA8B,IAAI,GAAG;AACjD,YAAM,SAAS,MAAM,YAAY,8IAA8I,EAAE,GAAG,MAAM,GAAG,oBAAoB,CAAC;AAClN,aAAO,OAAO,MAAM,YAAY,MAAM;AAAA,IAC1C,GAf6B;AAiB7B,UAAM,2BAA2B,mCAAY;AACzC,YAAM,OAAO,MAAM,YAAY,mEAAmE;AAClG,aAAO,KAAK,MAAM,eAAe,OAAO,IAAI,CAAC,MAAW,EAAE,IAAI,KAAK,CAAC;AAAA,IACxE,GAHiC;AAKjC,UAAM,uBAAuB,8BAAO,YAAoBA,cAAoB;AACxE,YAAM,OAAO,UAAU,WAAW,YAAY,EAAE,QAAQ,cAAc,GAAG,CAAC;AAE1E,YAAM,OAAO,MAAM,YAAY,6FAA6F,EAAE,GAAG,WAAW,CAAC;AAE7I,YAAM,WAAW,KAAK,MAAM,YAAY,OAAO,KAAK,CAAC,MAAW,EAAE,KAAK,SAAS,QAAQ,EAAE,KAAK,SAAS,GAAG,UAAU,YAAY,GAAG;AACpI,UAAI,SAAU,QAAO,SAAS;AAE9B,cAAQ,IAAI,8BAA8B,UAAU,GAAG;AACvD,YAAM,SAAS;AAAA,QACX,MAAM,GAAG,UAAU;AAAA,QACnB;AAAA,QACA,SAAS;AAAA,QACT,OAAO;AAAA,MACX;AAEA,YAAM,YAAY,MAAM,YAAY,8HAA8H;AAAA,QAC9J,OAAO;AAAA,MACX,CAAC;AAED,YAAM,SAAS,UAAU,MAAM;AAE/B,UAAI,QAAQ,QAAQ,SAAS,GAAG;AAC5B,YAAI,OAAO,OAAO,KAAK,CAAC,MAAW,EAAE,UAAU,MAAM,GAAG;AACpD,gBAAM,aAAa,MAAM,YAAY,0FAA0F,EAAE,GAAG,KAAK,CAAC;AAC1I,gBAAM,QAAQ,WAAW,MAAM,YAAY,OAAO,KAAK,CAAC,MAAW,EAAE,KAAK,SAAS,IAAI,GAAG;AAC1F,cAAI,MAAO,QAAO,MAAM;AAAA,QAC5B;AACA,gBAAQ,MAAM,oCAAoC,KAAK,UAAU,OAAO,MAAM,CAAC;AAC/E,eAAO;AAAA,MACX;AAEA,YAAM,QAAQ,QAAQ,WAAW;AACjC,UAAI,OAAO;AACP,gBAAQ,IAAI,2BAA2B,KAAK,EAAE;AAE9C,mBAAW,MAAMA,WAAU;AACvB,gBAAM,YAAY,yGAAyG,EAAE,IAAI,GAAG,IAAI,OAAO,EAAE,eAAe,CAAC,KAAK,EAAE,EAAE,CAAC;AAAA,QAC/K;AAEA,cAAM,QAAQ,MAAM,yBAAyB;AAC7C,mBAAW,QAAQ,OAAO;AACtB,gBAAM,YAAY,qHAAqH,EAAE,IAAI,KAAK,IAAI,OAAO,EAAE,eAAe,CAAC,KAAK,EAAE,EAAE,CAAC;AAAA,QAC7L;AAAA,MACJ;AACA,aAAO;AAAA,IACX,GA9C6B;AAgD7B,mBAAe,aAAa,WAAmB,UAAkB,OAAe;AAC5E,cAAQ,IAAI,oCAAoC;AAGhD,YAAM,WAAW,MAAM,YAAY,uDAAuD,EAAE,IAAI,UAAU,CAAC;AAC3G,YAAM,gBAAgB,SAAS,MAAM,SAAS,SAAS,CAAC;AAGxD,UAAI,cAAc,SAAS,GAAG;AAC1B,gBAAQ,IAAI,qBAAqB,cAAc,MAAM,qBAAqB;AAC1E,mBAAW,SAAS,eAAe;AAC/B,gBAAM,YAAY,iFAAiF,EAAE,IAAI,MAAM,GAAG,CAAC;AAAA,QACvH;AAAA,MACJ;AAEA,YAAM,eAAe;AACrB,UAAI,YAAyB;AAC7B,UAAI,cAAc;AACd,YAAI;AACA,gBAAM,gBAAgB,MAAM,MAAM,QAAQ;AAC1C,cAAI,cAAc,IAAI;AAClB,kBAAM,eAAe,MAAM,cAAc,KAAK;AAC9C,kBAAM,WAAW,IAAI,SAAS;AAC9B,qBAAS,OAAO,cAAc,cAAc,cAAc;AAC1D,qBAAS,OAAO,oBAAoB,QAAQ;AAC5C,qBAAS,OAAO,UAAU,MAAM;AAChC,kBAAM,QAAQ,MAAM,MAAM,wCAAwC;AAAA,cAC9D,QAAQ;AAAA,cACR,SAAS,EAAE,aAAa,aAAa;AAAA,cACrC,MAAM;AAAA,YACV,CAAC;AACD,gBAAI,MAAM,GAAI,aAAY,MAAM,MAAM,KAAK;AAAA,UAC/C;AAAA,QACJ,SAAS,GAAG;AACR,kBAAQ,MAAM,4BAA4B,CAAC;AAAA,QAC/C;AAAA,MACJ;AAEA,UAAI,WAAW;AACX,cAAM,KAAK,IAAI,SAAS;AACxB,cAAM,MAAM;AAAA,UACR,OAAO;AAAA,UACP,WAAW,EAAE,GAAG,WAAW,GAAG,MAAM,GAAG,MAAM;AAAA,QACjD;AACA,WAAG,OAAO,cAAc,KAAK,UAAU,GAAG,CAAC;AAC3C,WAAG,OAAO,OAAO,KAAK,UAAU,EAAE,KAAK,CAAC,aAAa,EAAE,CAAC,CAAC;AACzD,WAAG,OAAO,KAAK,WAAW,YAAY;AACtC,cAAM,MAAM,QAAS,EAAE,QAAQ,QAAQ,SAAS,EAAE,iBAAiB,YAAY,GAAG,MAAM,GAAG,CAAC;AAAA,MAChG,OAAO;AACH,cAAM,YAAY,iLAAiL;AAAA,UAC/L,IAAI;AAAA,UAAW,KAAK;AAAA,UAAU,KAAK;AAAA,QACvC,CAAC;AAAA,MACL;AAAA,IACJ;AArDe;AAuDf,UAAM,WAAW,MAAM,kBAAkB;AACzC,UAAM,kBAAmB,gBAAgB,CAAC,GAAG,qBAAkC,CAAC;AAChF,UAAM,WAAW,CAAC,mBAAmB,gBAAgB,WAAW;AAChE,UAAM,qBAAqB,WAAW,OAAO,KAAK,kBAAkB,IAAI;AACxE,UAAM,iBAAiB,SAAS;AAAA,MAAO,CAAC,OACpC,mBAAmB,KAAK,CAAC,MAAc,mBAAmB,CAAC,MAAM,GAAG,IAAI;AAAA,IAC5E;AAEA,QAAI,SAAS,WAAW,GAAG;AAAE,cAAQ,MAAM,6BAA6B;AAAG;AAAA,IAAQ;AAInF,UAAM,gBAA0B,CAAC,iBAAiB;AAClD,UAAM,gBAAgB,oBAAI,IAAwE;AAElG,YAAQ,IAAI,kCAAkC,cAAc,MAAM,oBAAoB;AACtF,eAAW,UAAU,eAAe;AAChC,YAAM,cAAc,MAAM,qBAAqB,MAAM;AACrD,UAAI,cAAc,MAAM,qBAAqB,QAAQ,QAAQ;AAC7D,UAAI,CAAC,YAAa,eAAc;AAChC,oBAAc,IAAI,QAAQ,EAAE,aAAa,YAAY,CAAC;AAAA,IAC1D;AAGA,YAAQ,IAAI,wBAAwB,SAAS,MAAM,cAAc;AAEjE,UAAM,sBAAgC,CAAC;AAEvC,UAAM,QAAQ,IAAI,SAAS,IAAI,OAAO,UAAe;AACjD,YAAM,IAAI,MAAM;AAChB,YAAM,aAAa;AACnB,YAAM,UAAU,cAAc,IAAI,UAAU;AAC5C,YAAM,cAAc,SAAS;AAC7B,YAAM,oBAAoB,SAAS;AAEnC,UAAI,iBAAgC;AACpC,YAAM,aAAa,EAAE,MAAM,KAAK;AAChC,YAAM,kBAAkB,WAAW,YAAY,EAAE,QAAQ,eAAe,GAAG,EAAE,QAAQ,YAAY,EAAE;AAEnG,YAAM,YAAY,MAAM,YAAY,oDAAoD,EAAE,GAAG,gBAAgB,CAAC;AAC9G,uBAAiB,UAAU,MAAM,SAAS;AAE1C,UAAI,CAAC,gBAAgB;AACjB,cAAM,gBAAgB,MAAM,YAAY,+GAA+G;AAAA,UACnJ,OAAO;AAAA,YACH,MAAM,EAAE;AAAA,YACR,MAAM;AAAA,YACN,mBAAmB,EAAE,GAAG,MAAM,GAAG,EAAE,IAAI;AAAA,YACvC,aAAa;AAAA,YACb,UAAU;AAAA,YACV,aAAa,eAAe,EAAE,mBAAmB,EAAE,KAAK;AAAA,YACxD,UAAU,CAAC,EAAE,KAAK,SAAS,OAAO,WAAW,CAAC;AAAA,UAClD;AAAA,QACJ,CAAC;AACD,yBAAiB,cAAc,MAAM,eAAe,SAAS;AAAA,MACjE,OAAO;AACH,cAAM,YAAY,4GAA4G;AAAA,UAC1H,IAAI;AAAA,UACJ,OAAO;AAAA,YACH,aAAa,eAAe,EAAE,mBAAmB,EAAE,KAAK;AAAA,YACxD,mBAAmB,EAAE,GAAG,MAAM,GAAG,EAAE,IAAI;AAAA,YACvC,UAAU,CAAC,EAAE,KAAK,SAAS,OAAO,WAAW,CAAC;AAAA,UAClD;AAAA,QACJ,CAAC;AAAA,MACL;AAEA,UAAI,CAAC,eAAgB;AAErB,UAAI,eAAe,oBAAoB;AACnC,cAAM,YAAY,gHAAgH;AAAA,UAC9H,IAAI;AAAA,UACJ,OAAO,EAAE,YAAY,CAAC,EAAE,IAAI,oBAAoB,WAAW,YAAY,CAAC,EAAE;AAAA,QAC9E,CAAC;AAAA,MACL;AAIA,UAAI,EAAE,QAAQ,QAAQ,CAAC,GAAG,MAAM,KAAK;AACjC,cAAM,aAAa,gBAAgB,EAAE,OAAO,MAAM,CAAC,EAAE,KAAK,KAAK,EAAE,KAAK;AAAA,MAC1E;AAEA,YAAM,WAAW,EAAE,UAAU,SAAS,CAAC;AACvC,YAAM,kBAAkB,MAAM,YAAY,6DAA6D,EAAE,IAAI,eAAe,CAAC;AAC7H,YAAM,mBAAmB,gBAAgB,MAAM,SAAS,YAAY,CAAC;AACrE,UAAI,iBAAiB,SAAS,GAAG;AAC7B,cAAM,YAAY,+FAA+F,EAAE,KAAK,iBAAiB,IAAI,CAAC,MAAW,EAAE,EAAE,EAAE,CAAC;AAAA,MACpK;AAGA,iBAAW,SAAS,UAAU;AAC1B,cAAM,IAAI,MAAM;AAChB,cAAM,qBAAqB,GAAG,EAAE,GAAG,MAAM,GAAG,EAAE,IAAI,CAAC,IAAI,EAAE,GAAG,MAAM,GAAG,EAAE,IAAI,CAAC;AAC5E,cAAM,YAAY,uIAAuI;AAAA,UACrJ,OAAO;AAAA,YACH,SAAS;AAAA,YACT,KAAK,EAAE,OAAO;AAAA;AAAA,YACd,MAAM,EAAE,SAAS;AAAA,YACjB,mBAAmB;AAAA,YACnB,YAAY,CAAC;AAAA,YACb,gBAAgB;AAAA,YAChB,QAAQ,oBAAoB,CAAC,EAAE,WAAW,mBAAmB,UAAU,EAAE,qBAAqB,EAAE,CAAC,IAAI,CAAC;AAAA,UAC1G;AAAA,QACJ,CAAC;AAAA,MACL;AAGA,YAAM,WAAU,oBAAI,KAAK,GAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC;AACrD,YAAM,kBAAkB,eAAe,IAAI,CAAC,QAAa;AAAA,QACrD,WAAW,GAAG;AAAA,QACd,aAAa;AAAA,QACb,iBAAiB;AAAA,QACjB,wBAAwB;AAAA,QACxB,mBAAmB;AAAA,QACnB,wBAAwB,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,KAAK,GAAI,EAAE,YAAY;AAAA,MACnF,EAAE;AACF,YAAM,YAAY,0IAA0I;AAAA,QACxJ,IAAI;AAAA,QACJ,OAAO,EAAE,gBAAgB,gBAAgB;AAAA,MAC7C,CAAC;AAGD,iBAAW,SAAS,EAAE,SAAS,OAAO;AAClC,cAAM,IAAI,MAAM;AAChB,cAAMC,mBAAkB,GAAG,EAAE,GAAG,MAAM,GAAG,EAAE,IAAI,CAAC,IAAI,EAAE,GAAG,MAAM,GAAG,EAAE,IAAI,CAAC;AAGzE,cAAM,UAAU,MAAM,YAAY,uEAAuE,EAAE,GAAGA,iBAAgB,CAAC;AAC/H,cAAM,YAAY,QAAQ,MAAM,gBAAgB;AAEhD,YAAI,WAAW;AACX,gBAAM,QAAQ,WAAW,EAAE,SAAS,GAAG;AACvC,cAAI,QAAQ,GAAG;AACX,kBAAM,gBAAgB,eAAe,IAAI,CAAC,QAAa;AAAA,cACnD,WAAW,GAAG;AAAA,cACd;AAAA,cACA,WAAW,WAAW,EAAE,oBAAoB,MAAM,SAAS,CAAC;AAAA,YAChE,EAAE;AACF,kBAAM,YAAY,gKAAgK;AAAA,cAC9K,IAAI;AAAA,cACJ,OAAO;AAAA,YACX,CAAC;AAAA,UACL;AAAA,QACJ;AAAA,MACJ;AAGA,UAAI,gBAAgB;AAChB,4BAAoB,KAAK,cAAc;AAAA,MAC3C;AAAA,IACJ,CAAC,CAAC;AAGF,QAAI,oBAAoB,SAAS,GAAG;AAChC,YAAM,sBAAsB,QAAQ,EAAE,YAAY,oBAAoB,CAAC;AAAA,IAC3E;AAEA,YAAQ,IAAI,MAAM,YAAY,uBAAuB,iBAAiB,EAAE;AAAA,EAC5E,GAzYK;AA0YT,CAAC;",
  "names": ["channels", "predictableSlug"]
}
