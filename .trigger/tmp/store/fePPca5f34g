{
  "version": 3,
  "sources": ["../../../src/lib/encryption.ts"],
  "sourcesContent": ["import crypto from 'crypto';\r\n\r\nconst ALGORITHM = 'aes-256-gcm';\r\nconst IV_LENGTH = 12; // Standard for GCM\r\nconst AUTH_TAG_LENGTH = 16;\r\n\r\n/**\r\n * Encrypts text using AES-256-GCM.\r\n * Output format: iv:authTag:encryptedData (Base64)\r\n */\r\nexport function encrypt(text: string): string {\r\n    const secret = process.env.ENCRYPTION_SECRET;\r\n    if (!secret || secret.length !== 64) {\r\n        throw new Error('ENCRYPTION_SECRET must be a 64-character hex string (32 bytes).');\r\n    }\r\n\r\n    const key = Buffer.from(secret, 'hex');\r\n    const iv = crypto.randomBytes(IV_LENGTH);\r\n    const cipher = crypto.createCipheriv(ALGORITHM, key, iv);\r\n\r\n    let encrypted = cipher.update(text, 'utf8', 'base64');\r\n    encrypted += cipher.final('base64');\r\n\r\n    const authTag = cipher.getAuthTag().toString('base64');\r\n\r\n    return `${iv.toString('base64')}:${authTag}:${encrypted}`;\r\n}\r\n\r\n/**\r\n * Decrypts text using AES-256-GCM.\r\n * Input format: iv:authTag:encryptedData (Base64)\r\n */\r\nexport function decrypt(encryptedText: string): string {\r\n    const secret = process.env.ENCRYPTION_SECRET;\r\n    if (!secret || secret.length !== 64) {\r\n        throw new Error('ENCRYPTION_SECRET must be a 64-character hex string (32 bytes).');\r\n    }\r\n\r\n    const parts = encryptedText.split(':');\r\n    if (parts.length !== 3) {\r\n        throw new Error('Invalid encrypted text format. Expected iv:authTag:encryptedData');\r\n    }\r\n\r\n    const [ivBase64, authTagBase64, encryptedBase64] = parts;\r\n    const key = Buffer.from(secret, 'hex');\r\n    const iv = Buffer.from(ivBase64, 'base64');\r\n    const authTag = Buffer.from(authTagBase64, 'base64');\r\n\r\n    const decipher = crypto.createDecipheriv(ALGORITHM, key, iv);\r\n    decipher.setAuthTag(authTag);\r\n\r\n    let decrypted = decipher.update(encryptedBase64, 'base64', 'utf8');\r\n    decrypted += decipher.final('utf8');\r\n\r\n    return decrypted;\r\n}\r\n"],
  "mappings": ";;;;;;AAAA;AAAA,OAAO,YAAY;AAEnB,IAAM,YAAY;AA8BX,SAAS,QAAQ,eAA+B;AACnD,QAAM,SAAS,QAAQ,IAAI;AAC3B,MAAI,CAAC,UAAU,OAAO,WAAW,IAAI;AACjC,UAAM,IAAI,MAAM,iEAAiE;AAAA,EACrF;AAEA,QAAM,QAAQ,cAAc,MAAM,GAAG;AACrC,MAAI,MAAM,WAAW,GAAG;AACpB,UAAM,IAAI,MAAM,kEAAkE;AAAA,EACtF;AAEA,QAAM,CAAC,UAAU,eAAe,eAAe,IAAI;AACnD,QAAM,MAAM,OAAO,KAAK,QAAQ,KAAK;AACrC,QAAM,KAAK,OAAO,KAAK,UAAU,QAAQ;AACzC,QAAM,UAAU,OAAO,KAAK,eAAe,QAAQ;AAEnD,QAAM,WAAW,OAAO,iBAAiB,WAAW,KAAK,EAAE;AAC3D,WAAS,WAAW,OAAO;AAE3B,MAAI,YAAY,SAAS,OAAO,iBAAiB,UAAU,MAAM;AACjE,eAAa,SAAS,MAAM,MAAM;AAElC,SAAO;AACX;AAvBgB;",
  "names": []
}
